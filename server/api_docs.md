# Соглашения по API в микросервисной архитектуре CompEduX

## Общие принципы

1. **Структура URL**:
    - **Клиент → API Gateway**: `/api/v1/{service}/{endpoint}`
    - **API Gateway → Сервис**: `/{endpoint}`

2. **Версионирование**:
    - Версия API указывается в URL: `/api/v1/...`
    - Каждый сервис должен поддерживать только текущую версию API

3. **Форматы данных**:
    - Все API используют JSON как основной формат данных
    - Даты передаются в формате ISO 8601 (например, `2025-04-16T20:45:59Z`)
    - UUID передаются в виде строк (например, `"123e4567-e89b-12d3-a456-426614174000"`)

## Аутентификация и авторизация

1. **Токены**:
    - Аутентификация проходит через JWT токены
    - Токены передаются в заголовке `Authorization: Bearer {token}`
    - API Gateway должен проверять валидность токенов для защищенных маршрутов

2. **Эндпоинты аутентификации** (`auth_service`):
    - POST `/login` - авторизация пользователя
    - POST `/register` - регистрация нового пользователя
    - POST `/refresh` - обновление токена
    - POST или GET `/logout` - выход из системы
    - GET `/me` - получение информации о текущем пользователе
    - POST `/verify-token` - проверка валидности токена

## Здоровье сервисов

1. **Health Check**:
    - Каждый сервис должен предоставлять эндпоинт `/health`
    - Формат ответа: `{"status": "healthy"}`
    - API Gateway должен регулярно проверять здоровье всех сервисов

## Обработка ошибок

1. **Формат ошибок**:
   ```json
   {
     "detail": "Описание ошибки",
     "code": "ERROR_CODE",
     "timestamp": "2025-04-16T20:45:59Z"
   }
   ```

2. **HTTP коды**:
    - 200 - успешный запрос
    - 201 - ресурс создан
    - 400 - некорректный запрос
    - 401 - не авторизован
    - 403 - доступ запрещен
    - 404 - ресурс не найден
    - 422 - ошибка валидации данных
    - 500 - внутренняя ошибка сервера
    - 503 - сервис недоступен

## Именование

1. **Эндпоинты**:
    - Используйте существительные во множественном числе для ресурсов: `/users`, `/courses`
    - Используйте глаголы для действий: `/login`, `/logout`, `/register`

2. **Параметры запросов**:
    - Используйте snake_case для параметров запросов: `user_id`, `course_name`

## Префиксы сервисов

- `auth` - сервис аутентификации и управления пользователями
- `rooms` - сервис управления комнатами
- `competitions` - сервис соревнований
- `achievements` - сервис достижений
- `courses` - сервис курсов

## Примеры маршрутов

1. **Auth Service**:
    - Клиент: `/api/v1/auth/login` → API Gateway → Auth Service: `/login`
    - Клиент: `/api/v1/auth/me` → API Gateway → Auth Service: `/me`

2. **Course Service**:
    - Клиент: `/api/v1/courses/list` → API Gateway → Course Service: `/list`
    - Клиент: `/api/v1/courses/123/content` → API Gateway → Course Service: `/123/content`
