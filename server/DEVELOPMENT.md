# Руководство по режиму разработки

В этом документе описано, как использовать режим разработки для проекта CompEduX.

## Структура проекта

Проект использует микросервисную архитектуру с следующими сервисами:

- **api_gateway** - API шлюз, который маршрутизирует запросы к соответствующим сервисам
- **auth_service** - Сервис аутентификации и авторизации
- **room_service** - Сервис для управления комнатами
- **competition_service** - Сервис для управления соревнованиями
- **achievement_service** - Сервис для управления достижениями

## Запуск в режиме разработки

Для запуска проекта в режиме разработки используйте следующую команду:

```bash
./dev.sh
```

Или вручную:

```bash
docker-compose up
```

По умолчанию Docker Compose автоматически подключает файл `docker-compose.override.yml`, который настраивает режим разработки.

### Особенности режима разработки

1. **Автоматическая перезагрузка кода**:
   - При изменении файлов сервисы автоматически перезапускаются
   - Используется uvicorn с флагом `--reload`

2. **Монтирование кода**:
   - Код монтируется как volume, что позволяет видеть изменения в реальном времени
   - Используется опция `:delegated` для улучшения производительности

3. **Открытые порты**:
   - Каждый сервис доступен напрямую через свой порт:
     - API Gateway: http://localhost:8000
     - Auth Service: http://localhost:8001
     - Room Service: http://localhost:8002
     - Achievement Service: http://localhost:8003
     - Competition Service: http://localhost:8004

4. **Отладка**:
   - Включен режим отладки (`DEBUG=true`)
   - Установлены инструменты для тестирования (pytest, pytest-cov)

## Работа с базой данных

База данных PostgreSQL доступна по адресу:
- Хост: localhost
- Порт: 5432
- Пользователь: postgres (или значение из .env)
- Пароль: secure_password (или значение из .env)
- База данных: competition_platform (или значение из .env)

## Полезные скрипты

Проект содержит несколько полезных скриптов для разработки:

### Запуск в режиме разработки

```bash
./dev.sh
```

### Запуск в production режиме

```bash
./prod.sh
```

### Просмотр логов

Для просмотра логов всех сервисов:

```bash
./logs.sh
```

Для просмотра логов конкретного сервиса:

```bash
./logs.sh auth_service
```

### Перезапуск сервиса

```bash
./restart-service.sh auth_service
```

### Запуск тестов

Для запуска тестов всех сервисов:

```bash
./run-tests.sh
```

Для запуска тестов конкретного сервиса:

```bash
./run-tests.sh auth_service
```

С дополнительными параметрами:

```bash
./run-tests.sh auth_service -v --cov
```

### Создание нового сервиса

```bash
./create-service.sh new_feature
```

Этот скрипт создаст новый сервис с базовой структурой в директории `new_feature_service`.

## Запуск отдельных сервисов

Для запуска только определенных сервисов используйте:

```bash
docker-compose up auth_service competition_service
```

## Остановка всех сервисов

```bash
docker-compose down
```

## Запуск в production режиме

Для запуска в production режиме используйте:

```bash
ENV=production docker-compose up -d
```

Или скрипт:

```bash
./prod.sh
```

Это отключит режим разработки и использует production Dockerfile для каждого сервиса.

## Обновление зависимостей

При добавлении новых зависимостей в `requirements.txt` необходимо пересобрать образы:

```bash
docker-compose build --no-cache [service_name]
```

## Отладка с помощью IDE

Для отладки с помощью IDE (например, PyCharm или VS Code) можно использовать открытые порты сервисов и настроить удаленную отладку.

## Структура Dockerfile

Каждый сервис имеет три Dockerfile:

1. **base.Dockerfile** - Базовый образ с установленными зависимостями
2. **development.Dockerfile** - Образ для разработки с автоматической перезагрузкой
3. **production.Dockerfile** - Образ для production с оптимизациями

## Переменные окружения

Переменные окружения настраиваются в файле `.env`. Для разработки можно использовать значения по умолчанию, но для production необходимо установить безопасные значения.
