# Модуль аутентификации

Этот модуль предоставляет полное решение для аутентификации в приложении CompEduX, реализованное с использованием
библиотеки Decompose для навигации и MVIKotlin для управления состоянием.

## Архитектура

Модуль аутентификации следует компонентной архитектуре с четким разделением обязанностей:

- **AuthComponent**: Основной компонент, отвечающий за навигацию между экранами входа, регистрации и профиля
- **AuthStore**: Центральное хранилище для управления состоянием аутентификации с использованием MVIKotlin
- **NavigationExecutor**: Утилита для безопасных операций навигации между потоками

## Компоненты

### AuthComponent

Основная точка входа для потока аутентификации. Управляет навигацией между тремя подкомпонентами:

- **LoginComponent**: Обрабатывает вход пользователя
- **RegisterComponent**: Обрабатывает регистрацию пользователя
- **ProfileComponent**: Отображает профиль пользователя и предоставляет функцию выхода из системы

### Управление состоянием

Состояние аутентификации управляется через `AuthStore`, который предоставляет реактивный поток состояния, за которым
могут наблюдать компоненты. Состояние включает:

- **isAuthenticated**: Логическое значение, указывающее, аутентифицирован ли пользователь
- **user**: Информация о пользователе при аутентификации
- **isLoading**: Состояние загрузки во время асинхронных операций
- **error**: Информация об ошибке при сбое аутентификации

## Поток навигации

Поток аутентификации работает следующим образом:

1. Пользователь начинает с экрана входа
2. Пользователь может перейти к регистрации или завершить вход
3. После успешной аутентификации пользователь автоматически перенаправляется на экран профиля
4. Из профиля пользователь может выйти из системы и вернуться на экран входа

## Безопасность потоков

Этот модуль включает специальную обработку, обеспечивающую выполнение всех операций навигации в главном потоке:

- `NavigationExecutor` обеспечивает безопасное выполнение вызовов навигации
- Области корутин привязаны к жизненному циклу компонентов для автоматической отмены
- Операции ввода-вывода выполняются в фоновых потоках
- Обновления UI и навигация выполняются в главном потоке

## Пример использования

```kotlin
// Создание компонента аутентификации
val authComponent = AuthComponent(
    componentContext = componentContext,
    onBack = { /* Обработка навигации назад */ }
)

// Подписка на состояние аутентификации
authComponent.state.collect { state ->
    if (state.isAuthenticated) {
        // Пользователь аутентифицирован
    } else {
        // Пользователь не аутентифицирован
    }
}
```

## Детали реализации

### Управление потоками

Модуль тщательно управляет потоками, чтобы предотвратить ошибки `NotOnMainThreadException`:

1. Все операции навигации выполняются синхронно в вызывающем потоке
2. Область корутин привязана к жизненному циклу компонента
3. Фоновые операции используют `rDispatchers.io`
4. Обновления UI и навигация используют `rDispatchers.main`
5. `MainThreadWorker` заменен прямой навигацией во избежание проблем с зависимостями

### Обработка ошибок

В модуле реализована комплексная обработка ошибок:

- Ошибки навигации перехватываются и логируются
- Ошибки аутентификации фиксируются в состоянии
- Корутины используют структурированную параллельность с правильной обработкой ошибок

## Конфигурация

Конечные точки аутентификации и поведение могут быть настроены через интерфейс `AuthUseCases`, который внедряется в
`AuthComponent`.
